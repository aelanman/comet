language: python
os: linux
sudo: required
dist: xenial

python:
    - 3.7
notifications:
    email: false
services:
    - redis-server
    - mysql

before_install:
    - pip install black
    - pip install pydocstyle
    - pip install pytest
    - pip install pytest-asyncio
    - pip install future  # FIXME: somehow this doesn't get installed as a dependency of caput

install:
    - python -m pip install .

before_script:
  - mysql -e "CREATE DATABASE test;"

script:
    # Run pycodestyle on all .py files in all subfolders
    - black --check .
    - pydocstyle --convention=numpy .

    # Run tests
    - export PYTHONPATH=.:$PYTHONPATH
    - cd tests
    - pytest -s
